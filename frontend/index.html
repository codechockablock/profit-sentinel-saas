<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profit Sentinel - Uncover Hidden Profit Leaks</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom, #f8fafc, #e2e8f0);
            min-height: 100vh;
        }

        .hero-gradient {
            background: linear-gradient(135deg, #064e3b 0%, #059669 50%, #10b981 100%);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .result-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(16, 185, 129, 0.2);
            transition: all 0.4s ease;
        }

        .result-card:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 30px 60px rgba(16, 185, 129, 0.15);
        }

        .glow-text {
            text-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.8s ease-out forwards;
        }

        .logo-glow {
            filter: drop-shadow(0 0 30px rgba(16, 185, 129, 0.6));
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Hero Header with Logo -->
    <header class="hero-gradient text-white py-16 md:py-24">
        <div class="container mx-auto px-6 text-center">
            <img src="YOUR_LOGO_URL_HERE.png" alt="Profit Sentinel Logo" class="mx-auto w-64 md:w-80 logo-glow mb-8">
            <!-- Replace YOUR_LOGO_URL_HERE.png with your hosted logo URL (upload to S3 or Vercel) -->
            <h1 class="text-5xl md:text-7xl font-black glow-text mb-6">Profit Sentinel</h1>
            <p class="text-xl md:text-2xl opacity-90 max-w-3xl mx-auto">Instant forensic analysis of your POS exports. Uncover hidden profit leaks ‚Äî no signup required.</p>
        </div>
    </header>

    <!-- Upload Section -->
    <section id="upload" class="py-20 -mt-10 relative z-10">
        <div class="container mx-auto px-6 max-w-4xl">
            <div class="glass-card p-12 rounded-3xl">
                <form id="uploadForm" class="space-y-10">
                    <div>
                        <label for="file" class="block text-3xl font-bold mb-6 text-gray-800">Upload POS Exports</label>
                        <p class="text-lg text-gray-600 mb-6">Multiple CSV or Excel files allowed. Instant analysis.</p>
                        <input type="file" id="file" name="file" accept=".csv,.xlsx,.xls" multiple class="w-full px-8 py-6 text-lg bg-white border-2 border-gray-300 rounded-2xl focus:border-emerald-500 focus:ring-4 focus:ring-emerald-200 transition">
                    </div>
                    <div>
                        <label for="email" class="block text-3xl font-bold mb-6 text-gray-800">Email for Report</label>
                        <input type="email" id="email" name="email" class="w-full px-8 py-6 text-lg bg-white border-2 border-gray-300 rounded-2xl focus:border-emerald-500 focus:ring-4 focus:ring-emerald-200 transition" placeholder="you@yourstore.com (optional)">
                    </div>
                    <button type="submit" class="w-full hero-gradient text-white font-black text-3xl py-8 rounded-3xl hover:opacity-90 transition transform hover:scale-105 shadow-2xl">
                        Analyze My Profits ‚Äî Free Beta
                    </button>
                </form>

                <div id="status" class="mt-12 text-3xl font-bold text-center"></div>
                <div id="uploadProgress" class="mt-10 space-y-6"></div>
                <div id="result" class="mt-16 hidden"></div>
            </div>
        </div>
    </section>

    <!-- Supabase Init -->
    <script>
        const { createClient } = supabase;
        const supabaseClient = createClient(
            'https://PLACEHOLDER_SUPABASE_PROJECT.supabase.co',
            'sb_publishable_gocACZSOQvdZ6XV1qiu28A_W19nqgYc'
        );
    </script>

    <!-- Main Script with Ultra-Premium Results -->
    <script>
        const form = document.getElementById('uploadForm');
        const status = document.getElementById('status');
        const uploadProgress = document.getElementById('uploadProgress');
        const result = document.getElementById('result');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const files = document.getElementById('file').files;
            if (files.length === 0) {
                status.textContent = 'Please select at least one file.';
                status.className = 'text-red-600';
                return;
            }

            status.textContent = 'Generating secure upload links...';
            status.className = 'text-emerald-600';
            uploadProgress.innerHTML = '';
            result.classList.add('hidden');

            const formData = new FormData();
            for (let file of files) formData.append('filenames', file.name);
            const emailValue = document.getElementById('email').value.trim();
            if (emailValue) formData.append('email', emailValue);

            let headers = {};
            try {
                const { data: { session } } = await supabaseClient.auth.getSession();
                if (session) headers['Authorization'] = `Bearer ${session.access_token}`;
            } catch (err) {}

            try {
                const presignRes = await fetch('https://profitsentinel-dev-alb-1068333431.us-east-1.elb.amazonaws.com/presign', {
                    method: 'POST', headers, body: formData
                });
                if (!presignRes.ok) throw new Error(await presignRes.text());
                const { presigned } = await presignRes.json();

                status.textContent = `Uploading ${files.length} file${files.length > 1 ? 's' : ''}...`;
                uploadProgress.innerHTML = '';
                const progressBars = [];
                presigned.forEach((p, i) => {
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <p class="text-lg font-medium text-gray-700 mb-2">${files[i].name} <span class="text-sm text-gray-500">(${(files[i].size / 1024 / 1024).toFixed(1)} MB)</span></p>
                        <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-emerald-500 to-emerald-600 rounded-full transition-all duration-300" id="bar-${i}"></div>
                        </div>
                    `;
                    uploadProgress.appendChild(div);
                    progressBars.push(document.getElementById(`bar-${i}`));
                });

                const uploadPromises = presigned.map(async (p, i) => {
                    const file = files[i];
                    const xhr = new XMLHttpRequest();
                    return new Promise((resolve, reject) => {
                        xhr.upload.addEventListener('progress', e => {
                            if (e.lengthComputable) progressBars[i].style.width = (e.loaded / e.total) * 100 + '%';
                        });
                        xhr.addEventListener('load', () => xhr.status >= 200 && xhr.status < 300 ? resolve(p.key) : reject());
                        xhr.addEventListener('error', reject);
                        xhr.open('POST', p.url.url);
                        const uf = new FormData();
                        Object.keys(p.url.fields).forEach(k => uf.append(k, p.url.fields[k]));
                        uf.append('file', file);
                        xhr.send(uf);
                    });
                });

                await Promise.all(uploadPromises);

                status.textContent = 'Analyzing your inventory...';

                const analyzeForm = new FormData();
                presigned.forEach(p => analyzeForm.append('keys', p.key));
                if (emailValue) analyzeForm.append('email', emailValue);

                const analyzeRes = await fetch('https://profitsentinel-dev-alb-1068333431.us-east-1.elb.amazonaws.com/analyze', {
                    method: 'POST', headers, body: analyzeForm
                });
                if (!analyzeRes.ok) throw new Error(await analyzeRes.text());
                const data = await analyzeRes.json();

                uploadProgress.innerHTML = '';
                status.innerHTML = '<div class="text-4xl font-black text-emerald-600 glow-text">Analysis Complete üöÄ</div>';

                // Premium Results
                let totalHidden = 0, totalNegative = 0, maxImpact = 0;
                data.results.forEach(r => {
                    if (r.status === "success") {
                        totalHidden += r.estimated_hidden_cogs || 0;
                        totalNegative += r.negative_items || 0;
                        maxImpact = Math.max(maxImpact, r.margin_impact_pct || 0);
                    }
                });

                result.innerHTML = `
                    <div class="mt-20">
                        <div class="hero-gradient text-white p-12 md:p-20 rounded-3xl shadow-2xl text-center mb-20">
                            <h2 class="text-5xl md:text-6xl font-black mb-8 glow-text">Your Profit Leak Report</h2>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-10 max-w-5xl mx-auto">
                                <div class="bg-white/10 backdrop-blur rounded-2xl p-8">
                                    <p class="text-emerald-100 text-xl mb-4">Files Analyzed</p>
                                    <p class="text-6xl font-black">${data.results.length}</p>
                                </div>
                                <div class="bg-white/10 backdrop-blur rounded-2xl p-8">
                                    <p class="text-emerald-100 text-xl mb-4">Hidden COGS</p>
                                    <p class="text-6xl font-black $${totalHidden > 0 ? 'text-yellow-300' : ''}">$${totalHidden.toLocaleString()}</p>
                                </div>
                                <div class="bg-white/10 backdrop-blur rounded-2xl p-8">
                                    <p class="text-emerald-100 text-xl mb-4">Negative Items</p>
                                    <p class="text-6xl font-black ${totalNegative > 0 ? 'text-red-300' : 'text-emerald-200'}">${totalNegative}</p>
                                </div>
                                <div class="bg-white/10 backdrop-blur rounded-2xl p-8">
                                    <p class="text-emerald-100 text-xl mb-4">Max Impact</p>
                                    <p class="text-6xl font-black ${maxImpact > 5 ? 'text-orange-300' : ''}">${maxImpact.toFixed(1)}%</p>
                                </div>
                            </div>
                            <p class="mt-12 text-3xl font-medium">
                                ${totalHidden > 0 || totalNegative > 0 ? 'üî¥ Profit leaks detected ‚Äî act now!' : 'üü¢ Your inventory is pristine. Excellent work!'}
                            </p>
                        </div>

                        <div class="grid gap-12 md:grid-cols-2 lg:grid-cols-3">
                            ${data.results.map((file, idx) => `
                                <div class="result-card rounded-3xl p-10 opacity-0 animate-fade-in-up" style="animation-delay: ${idx * 0.15}s">
                                    <h3 class="text-2xl font-bold mb-4 text-gray-800 truncate">${file.filename || 'Unknown File'}</h3>
                                    <p class="text-gray-600 mb-8">${(file.rows || 0).toLocaleString()} rows analyzed</p>
                                    ${file.status === 'success' ? `
                                        <div class="space-y-8">
                                            <div class="flex justify-between items-end">
                                                <span class="text-lg text-gray-600">Negative Items</span>
                                                <span class="text-5xl font-black ${file.negative_items > 0 ? 'text-red-600' : 'text-emerald-600'}">${file.negative_items}</span>
                                            </div>
                                            <div class="flex justify-between items-end">
                                                <span class="text-lg text-gray-600">Hidden COGS</span>
                                                <span class="text-5xl font-black text-emerald-600">$${file.estimated_hidden_cogs.toLocaleString()}</span>
                                            </div>
                                            <div class="flex justify-between items-end">
                                                <span class="text-lg text-gray-600">True Margin</span>
                                                <span class="text-4xl font-bold">${file.true_margin_pct.toFixed(1)}%</span>
                                            </div>
                                            <div class="pt-8 border-t border-gray-300">
                                                <p class="italic text-gray-700 leading-relaxed">${file.summary}</p>
                                                <p class="text-sm text-gray-600 mt-4">${file.recommendation}</p>
                                            </div>
                                        </div>
                                    ` : `
                                        <div class="text-red-600 font-bold text-xl">
                                            ‚ö†Ô∏è Partial Analysis<br><span class="text-lg font-normal mt-2 block">${file.detail}</span>
                                        </div>
                                    `}
                                </div>
                            `).join('')}
                        </div>

                        ${emailValue ? `<p class="text-center mt-16 text-xl text-gray-600">Full detailed report sent to <span class="font-bold">${emailValue}</span></p>` : ''}
                    </div>
                `;

                result.classList.remove('hidden');

            } catch (err) {
                console.error(err);
                status.textContent = 'Error: ' + (err.message || 'Upload/analysis failed');
                status.className = 'text-red-600';
            }
        });
    </script>
</body>
</html>